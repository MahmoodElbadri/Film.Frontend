<div class="container py-5">

  <div class="d-flex align-items-end justify-content-between mb-5">
    <div>
      <h1 class="text-gradient display-5 fw-bold mb-0">Dashboard</h1>
      <p class="text-muted lead mb-0">Overview of your cinema collection</p>
    </div>
    <span class="badge bg-light text-primary border border-primary rounded-pill px-3 py-2">
      üìÖ {{today | date }} </span>
  </div>

  <div class="row g-4 mb-5">
    <div class="col-md-4">
      <div class="card card-glass border-0 shadow-sm h-100 overflow-hidden position-relative group-hover-zoom">
        <div class="card-body p-4 position-relative z-1">
          <h6 class="text-uppercase text-muted fw-bold ls-1 mb-1">Total Movies</h6>
          <h2 class="display-4 fw-bold text-gradient mb-0">{{moviesNumber}}</h2>
          <div class="mt-3">
            <span class="badge bg-success bg-opacity-10 text-success rounded-pill">
              <i class="me-1">üìà</i> Collection Active
            </span>
          </div>
        </div>
        <div class="position-absolute end-0 bottom-0 opacity-10 me-n3 mb-n3">
          <span style="font-size: 8rem;">üé¨</span>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card card-glass border-0 shadow-sm h-100 overflow-hidden position-relative">
        <div class="card-body p-4 position-relative z-1">
          <h6 class="text-uppercase text-muted fw-bold ls-1 mb-1">Comedy</h6>
          <h2 class="display-4 fw-bold text-primary mb-0">{{comedyMoviesNumber}}</h2>
          <div class="mt-3">
            <small class="text-muted">Laughs & Fun</small>
          </div>
        </div>
        <div class="position-absolute end-0 bottom-0 opacity-10 me-n3 mb-n3">
          <span style="font-size: 8rem;">üòÇ</span>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card card-glass border-0 shadow-sm h-100 overflow-hidden position-relative">
        <div class="card-body p-4 position-relative z-1">
          <h6 class="text-uppercase text-muted fw-bold ls-1 mb-1">Action</h6>
          <h2 class="display-4 fw-bold text-danger mb-0">{{actionMoviesNumber}}</h2>
          <div class="mt-3">
            <small class="text-muted">Thrills & Fights</small>
          </div>
        </div>
        <div class="position-absolute end-0 bottom-0 opacity-10 me-n3 mb-n3">
          <span style="font-size: 8rem;">üí•</span>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mb-5">

    <div class="col-lg-7">
      <div class="card card-glass border-0 shadow-lg h-100">
        <div class="card-header bg-transparent border-0 pt-4 px-4 pb-0 d-flex justify-content-between align-items-center">
          <div>
            <h4 class="fw-bold mb-0">Genre Distribution</h4>
            <small class="text-muted">Visual breakdown of your library</small>
          </div>
          <button class="btn btn-sm btn-icon btn-light rounded-circle shadow-sm">üìä</button>
        </div>

        <div class="card-body d-flex align-items-center justify-content-center position-relative" style="min-height: 400px;">
          <div class="w-100 h-100">
            <ngx-charts-pie-chart
              [view]="view"
              [results]="saleData"
              [gradient]="true"
              [legend]="false"
              [labels]="true"
              [doughnut]="isDoughnut"
              [animations]="true">
            </ngx-charts-pie-chart>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="card card-glass border-0 shadow-lg h-100">
        <div class="card-header bg-transparent border-0 pt-4 px-4 pb-2">
          <h4 class="fw-bold mb-0">Latest Additions</h4>
          <small class="text-muted">Recently added to the database</small>
        </div>

        <div class="card-body p-2">
          @if (last5Added && last5Added.length > 0) {
            <div class="list-group list-group-flush">
              @for (movie of last5Added; track movie.id) {
                <div class="list-group-item border-0 d-flex align-items-center p-3 rounded-3 hover-bg-light transition-base mb-1">

                  <div class="flex-shrink-0 me-3 position-relative">
                    <img [src]="movie.posterUrl"
                         [alt]="movie.title"
                         class="rounded-3 shadow-sm object-fit-cover"
                         style="width: 50px; height: 75px;"
                         onerror="this.src='https://placehold.co/50x75'">
                  </div>

                  <div class="flex-grow-1 min-width-0">
                    <h6 class="mb-1 fw-bold text-truncate">{{movie.title}}</h6>
                    <div class="d-flex align-items-center gap-2">
                      <span class="badge bg-primary bg-opacity-10 text-primary border border-primary rounded-pill" style="font-size: 0.7rem;">
                        {{movie.genre}}
                      </span>
                      <small class="text-muted" style="font-size: 0.75rem;">
                        üìÖ {{movie.releaseDate | date: 'shortDate'}}
                      </small>
                    </div>
                  </div>

                  <a [routerLink]="['/movies/details/', movie.id]"
                     class="btn btn-light btn-sm rounded-circle shadow-sm ms-2"
                     title="View Details">
                    ‚ûù
                  </a>
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-5 opacity-50">
              <div class="display-1 mb-3">üìΩÔ∏è</div>
              <p>No movies added yet.</p>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card card-glass border-0 shadow-sm">
        <div class="card-body p-4 p-md-5">
          <h5 class="fw-bold text-muted text-uppercase ls-1 mb-4">Genre Metrics</h5>

          <div class="row g-5">
            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-end mb-2">
                <span class="fw-bold text-dark">Comedy</span>
                <span class="badge bg-primary rounded-pill">{{comedyMoviesNumber}}</span>
              </div>
              <div class="progress" style="height: 10px; background-color: #e9ecef; border-radius: 10px;">
                <div class="progress-bar bg-gradient-primary rounded-pill"
                     role="progressbar"
                     [style.width.%]="(comedyMoviesNumber / moviesNumber) * 100"
                     aria-valuemin="0" aria-valuemax="100">
                </div>
              </div>
              <small class="text-muted mt-2 d-block text-end">{{ (comedyMoviesNumber / moviesNumber) | percent }} of total</small>
            </div>

            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-end mb-2">
                <span class="fw-bold text-dark">Action</span>
                <span class="badge bg-danger rounded-pill">{{actionMoviesNumber}}</span>
              </div>
              <div class="progress" style="height: 10px; background-color: #e9ecef; border-radius: 10px;">
                <div class="progress-bar bg-danger rounded-pill"
                     role="progressbar"
                     [style.width.%]="(actionMoviesNumber / moviesNumber) * 100"
                     aria-valuemin="0" aria-valuemax="100">
                </div>
              </div>
              <small class="text-muted mt-2 d-block text-end">{{ (actionMoviesNumber / moviesNumber) | percent }} of total</small>
            </div>

            <div class="col-md-4">
              <div class="d-flex justify-content-between align-items-end mb-2">
                <span class="fw-bold text-dark">Drama</span>
                <span class="badge bg-warning text-dark rounded-pill">{{dramaMoviesNumber}}</span>
              </div>
              <div class="progress" style="height: 10px; background-color: #e9ecef; border-radius: 10px;">
                <div class="progress-bar bg-warning rounded-pill"
                     role="progressbar"
                     [style.width.%]="(dramaMoviesNumber / moviesNumber) * 100"
                     aria-valuemin="0" aria-valuemax="100">
                </div>
              </div>
              <small class="text-muted mt-2 d-block text-end">{{ (dramaMoviesNumber / moviesNumber) | percent }} of total</small>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

</div>
