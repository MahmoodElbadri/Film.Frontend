<div class="container py-5">

  <div class="text-center mb-5">
    <h1 class="text-gradient display-5 fw-bold">
      @if(isAdd){ üé¨ Add New Movie } @else { ‚úèÔ∏è Update Movie }
    </h1>
    <p class="text-muted lead">Fill in the details below to manage your collection</p>
  </div>

  <div class="row g-4 justify-content-center">

    <div class="col-lg-7">
      <div class="card card-glass border-0 shadow-lg">
        <div class="card-body p-4 p-md-5">

          <form [formGroup]="addMovieForm" (ngSubmit)="onSubmit(addMovieForm.value)">

            <div class="form-floating mb-4">
              <input
                formControlName="title"
                class="form-control"
                id="title"
                placeholder="Movie Title"
                [class.is-invalid]="addMovieForm.get('title')?.invalid && addMovieForm.get('title')?.touched"
              >
              <label for="title">Movie Title</label>
              @if(addMovieForm.get('title')?.invalid && addMovieForm.get('title')?.touched){
                <div class="invalid-feedback">
                  <i class="me-1">‚ö†Ô∏è</i> Please enter a valid title
                </div>
              }
            </div>

            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    formControlName="genre"
                    class="form-control"
                    id="genre"
                    placeholder="Genre"
                    [class.is-invalid]="addMovieForm.get('genre')?.invalid && addMovieForm.get('genre')?.touched"
                  >
                  <label for="genre">Genre (e.g. Action)</label>
                  @if(addMovieForm.get('genre')?.invalid && addMovieForm.get('genre')?.touched){
                    <div class="invalid-feedback">Required</div>
                  }
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    formControlName="releaseDate"
                    class="form-control"
                    id="releaseDate"
                    type="date"
                    [class.is-invalid]="addMovieForm.get('releaseDate')?.invalid && addMovieForm.get('releaseDate')?.touched"
                  >
                  <label for="releaseDate">Release Date</label>
                  @if(addMovieForm.get('releaseDate')?.invalid && addMovieForm.get('releaseDate')?.touched){
                    <div class="invalid-feedback">Invalid Date</div>
                  }
                </div>
              </div>
            </div>

            <div class="form-floating mb-4">
              <input
                formControlName="posterUrl"
                class="form-control"
                id="posterUrl"
                placeholder="https://..."
                [class.is-invalid]="addMovieForm.get('posterUrl')?.invalid && addMovieForm.get('posterUrl')?.touched"
              >
              <label for="posterUrl">Poster Image URL</label>
              @if(addMovieForm.get('posterUrl')?.invalid && addMovieForm.get('posterUrl')?.touched){
                <div class="invalid-feedback">Please enter a valid URL</div>
              }
            </div>

            <div class="form-floating mb-4">
              <textarea
                formControlName="description"
                class="form-control"
                id="description"
                placeholder="Description"
                style="height: 150px"
                [class.is-invalid]="addMovieForm.get('description')?.invalid && addMovieForm.get('description')?.touched"
              ></textarea>
              <label for="description">Storyline / Description</label>
              @if(addMovieForm.get('description')?.invalid && addMovieForm.get('description')?.touched){
                <div class="invalid-feedback">Description is required</div>
              }
            </div>

            <div class="d-flex gap-3 pt-2">
              <button
                type="submit"
                class="btn btn-primary btn-gradient flex-grow-1 py-3 fw-bold shadow-sm hover-lift"
                [disabled]="addMovieForm.invalid"
              >
                {{ isAdd ? 'üöÄ Create Movie' : 'üíæ Save Changes' }}
              </button>

              <a [routerLink]="['/']" class="btn btn-outline-secondary px-4 py-3 hover-lift">
                Cancel
              </a>
            </div>

          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-5 d-none d-lg-block">
      <div class="sticky-top" style="top: 2rem; z-index: 1;">
        <h5 class="text-muted text-uppercase fw-bold ls-1 mb-3">Live Preview</h5>

        <div class="card card-glass border-0 shadow-lg overflow-hidden position-relative" style="min-height: 500px;">

          <div class="position-absolute top-50 start-50 translate-middle text-center text-muted"
               *ngIf="!addMovieForm.get('posterUrl')?.value">
            <span class="display-1 opacity-25">üñºÔ∏è</span>
            <p class="mt-2 small">Poster preview will appear here</p>
          </div>

          <img
            [src]="addMovieForm.get('posterUrl')?.value"
            class="img-fluid w-100 h-100 object-fit-cover"
            [alt]="addMovieForm.get('title')?.value || 'Movie Poster'"
            onerror="this.style.display='none'"
            onload="this.style.display='block'"
          >

          <div class="position-absolute bottom-0 start-0 w-100 p-4 bg-gradient-dark text-white">
            <h3 class="fw-bold mb-1">{{ addMovieForm.get('title')?.value || 'Movie Title' }}</h3>
            <span class="badge bg-primary">{{ addMovieForm.get('genre')?.value || 'Genre' }}</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
